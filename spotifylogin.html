<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="css/spotifylogin.css">
    <title>Spotify Playlist Generator</title>
</head>
<body style="font-family: Arial; margin: 40px;">
    <h1>Generate a Playlist from Your Top 5 Songs</h1>
    <button id="loginBtn" style="padding: 12px 20px; font-size: 18px;">
        Login with Spotify
    </button>

    <script>
        const clientId = "86759e67500b47eea6022b1f4d9e0c02";
        const redirectUri = "http://127.0.0.1/Fullstack-project/callback.php?code=AQB6TEgB8UmSL1XhOxIasj3dY6FPjDnN00AvNrdh66Y-1pe1mmR3sM5hHFGxoLQdqzsg-BbfOojM18i2coe_ISQi-4T8pxS7OMwhPyzdAsUvz3z-zpKdaBJpsVT5CDmMv6P4wLDvlyS3hOtQloUZdEiGlVs0TiZR8KYKUyn8QLK2O44V3wTn3snCaHiCrIFb269AGCLiPRqHojHph7pe5vU4j-D7sFDiWvqU9g6YCyVeoIwkoWU_Hr7--J-mXsDYocISCm9rCkS3cqgcrOHhvb-BMKSYBAVGHOZ1PscaxdNKo6EO0wmCvQHmUvO1YrtEM9jR6-6lKh_hW_QwJBGAkqqLjoLUVGqmelVNaSREFxCvqnZfK5nBqw&code=AQCCx4wtTe6lJB110vmll1rgSQDnJgFeccf5try0sBwP42imYOqT8AGLwFG-J0c7Dd99av9iW95ErrtDw5l7kRVLQnWIsWfT0RbDNewLxSJApEghoB86syTq4sGLncLxqxL-ItBXWGE08Fr_Xn4edrSWQVl4-X7FFbN2xwd_6Bu-GR4V95eTQiFu6YRJUWu52X8GyhZHWVmSrFUzCBuEYjKy-4TmPstWQ7MsHx2HSL3smnEEcp7DnNJEOEJTuUlblDfg_3VPhNsf4V8RqS51eRj9c8oUMLvtDlzEsXSkbFZG6EwsNi2OEUc5zSJ2LaFOjtw9njFUUeuoYnABIHpmQ3cnjVKCNVOz9RGkbtFhT68myXKIr_yNVEGijZcAiw_FFw4HQ3HXBl4aWNRj0IA5LT0XfwcPvig3RwrsSRN8HMVJezH4QLkTGWp9Llf-gKXqjdi_F5E0TEAD9k135ineei_DrENFsTL03iYz2m-0GIeAUffrRMoXWB8N8jPGVfLebGz2J64IPBcjM2SztcyvlOuEEzc0dlxF-EefP9AU2R6Qmgnnr5N4WEuqEgOgkyLWCCUug3k_NXacM2F_2aognWf1oNG-MyP6WHN52oabrF74CY7AoKK0HInKZJ8svYSXE5KyuNyqVx4uWqYNLF8ZKzRY7C-9u2TntD63J2oXYaRtFjcZweBhTgrGED7kg1PITkzlXADBfbq4j8rN7Kp9ngio1NGBVlOxBYWm4FfuIbjSAiXuRk8Ekre_0B1Zbn4XjxRlPVd9ko_jHib8qmIkgvnCf4kqb0zwINaI4yWxrdbs7pHX_LswkV33ijmchXu18mJacP0F5OJQzlJe3n6DmN05Fw";

        function generateRandomString(length) {
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
            let result = "";
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        async function sha256(verifier) {
            const data = new TextEncoder().encode(verifier);
            return await crypto.subtle.digest("SHA-256", data);
        }

        function base64URLEncode(buffer) {
            return btoa(
                Array.from(new Uint8Array(buffer))
                    .map(b => String.fromCharCode(b))
                    .join("")
            )
            .replace(/\+/g, "-")
            .replace(/\//g, "_")
            .replace(/=+$/, "");
        }

        document.getElementById("loginBtn").onclick = async () => {
            localStorage.removeItem("code_verifier");

            const codeVerifier = generateRandomString(128);
            localStorage.setItem("code_verifier", codeVerifier);

            const hashed = await sha256(codeVerifier);
            const codeChallenge = base64URLEncode(hashed);

            const scope = "user-top-read playlist-modify-public playlist-modify-private";

            const authUrl =
                "https://accounts.spotify.com/authorize" +
                `?client_id=${clientId}` +
                `&response_type=code` +
                `&redirect_uri=${encodeURIComponent(redirectUri)}` +
                `&code_challenge_method=S256` +
                `&code_challenge=${codeChallenge}` +
                `&scope=${encodeURIComponent(scope)}`;

            window.location.href = authUrl;
        };
    </script>
</body>
</html>
